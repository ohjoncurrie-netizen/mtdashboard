<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Montana County Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script async defer 
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXY5noMi8eAp2uM9zWOMHYGRC_k_PeRU0&libraries=geometry&callback=initGoogleMaps"
  type="text/javascript"></script>
  <link rel="stylesheet" crossorigin href="/assets/main-bEUOWiUV.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="modern-enhancements.css">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <div class="sidebar-logo">MT</div>
        <h2>Montana Explorer</h2>
      </div>
      <button class="sidebar-close" id="sidebar-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    
    <nav class="sidebar-nav">
      <span class="sidebar-nav-label">Navigation</span>
      <ul>
        <li><a href="#map-section" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg> View Map</a></li>
        <li><a href="#" id="sidebar-directory" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg> Browse Counties</a></li>
        <li><a href="#" id="sidebar-admin" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg> Admin Panel</a></li>
        <li><a href="#" id="sidebar-business" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/></svg> Business Directory</a></li>
        <li><a href="https://511.mt.gov/" target="_blank" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg> Road Conditions</a></li>
        <li><a href="https://visitmt.com/" target="_blank" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg> Visit Montana</a></li>
        <li><a href="https://fwp.mt.gov/" target="_blank" class="sidebar-link"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg> Fish, Wildlife & Parks</a></li>
      </ul>
    </nav>
    
    <div class="sidebar-facts">
      <span class="sidebar-nav-label">Quick Facts</span>
      <div class="fact-item">
        <h4>The Treasure State</h4>
        <p>Montana's nickname comes from its rich mineral reserves, including gold, silver, and copper.</p>
      </div>
      <div class="fact-item">
        <h4>Big Sky Country</h4>
        <p>Montana is the 4th largest state with 147,040 square miles of stunning landscapes.</p>
      </div>
      <div class="fact-item">
        <h4>Capital City</h4>
        <p>Helena is the state capital, while Billings is the largest city.</p>
      </div>
      <div class="fact-item">
        <h4>Glacier National Park</h4>
        <p>Home to over 700 miles of hiking trails and 26 glaciers (as of 2015).</p>
      </div>
      <div class="fact-item">
        <h4>Wildlife Paradise</h4>
        <p>Montana has more cattle than people and is home to grizzly bears, wolves, elk, and bison.</p>
      </div>
      <div class="fact-item">
        <h4>Statehood</h4>
        <p>Montana became the 41st state on November 8, 1889.</p>
      </div>
      <div class="fact-item">
        <h4>Agriculture</h4>
        <p>Montana is a leading producer of wheat, barley, and lentils in the United States.</p>
      </div>
      <div class="fact-item">
        <h4>Film Location</h4>
        <p>Many movies filmed here including "A River Runs Through It" and "The Revenant".</p>
      </div>
    </div>
  </aside>
  
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  
  <div class="container">
    <header>
      <div class="header-top">
        <div class="header-brand">
          <button id="sidebar-toggle" class="nav-btn menu-btn" aria-label="Menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="header-content">
            <h1>Montana County Explorer</h1>
            <p class="subtitle">Interactive Regional Intelligence Portal</p>
          </div>
        </div>
        <nav class="header-nav">
          <button id="directory-btn" class="nav-btn">Browse Counties</button>
          <button id="business-btn" class="nav-btn">Business Directory</button>
          <button id="discussion-btn" class="nav-btn">üí¨ Discussion</button>
          <button id="awards-btn" class="nav-btn">üèÜ Top 20</button>
          <button id="hud-toggle-btn" class="nav-btn">üí° Facts</button>
          <div class="auth-nav" id="auth-nav">
            <button id="auth-signin-btn" class="nav-btn auth-btn">Sign In</button>
            <button id="auth-register-btn" class="nav-btn auth-btn accent">Register</button>
          </div>
          <div class="user-nav" id="user-nav" style="display: none;">
            <button id="user-profile-btn" class="nav-btn user-btn"><span id="user-avatar-emoji">üë§</span> <span id="user-display-name">Profile</span></button>
            <button id="user-signout-btn" class="nav-btn">Sign Out</button>
          </div>
        </nav>
      </div>
    </header>

    <main>
      <!-- Breadcrumbs -->
      <section class="breadcrumb-section" id="breadcrumb-section">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="#/montana" id="breadcrumb-montana">Montana</a>
          <span class="breadcrumb-sep" id="breadcrumb-sep-county">/</span>
          <a href="#/montana" id="breadcrumb-county" class="breadcrumb-link disabled">County</a>
          <span class="breadcrumb-sep" id="breadcrumb-sep-city">/</span>
          <span id="breadcrumb-city" class="breadcrumb-current">City</span>
        </nav>
      </section>

      <!-- County Directory -->
      <section class="directory-section" id="directory-section" style="display: none;">
        <div class="card">
          <div class="directory-header">
            <h2>Browse Montana Counties</h2>
            <div class="directory-controls">
              <input type="text" id="directory-search" class="search-input" placeholder="Search counties...">
              <button class="nav-btn" id="directory-back-map">Back to Map</button>
            </div>
          </div>
          <div class="directory-grid" id="directory-grid">
            <p class="empty-state">Loading counties...</p>
          </div>
        </div>
      </section>

      <!-- County Page -->
      <section class="county-page" id="county-page" style="display: none;">
        <div class="card county-card">
          <div class="county-header">
            <h2 id="county-page-title">County</h2>
            <div class="county-actions">
              <button class="nav-btn" id="county-back-map">Back to Map</button>
              <button class="nav-btn" id="county-open-admin">Edit in Admin</button>
            </div>
          </div>
          <p id="county-page-description" class="county-description"></p>
          <div class="county-meta" id="county-meta"></div>
          <div class="county-cities">
            <h3>Cities & Towns</h3>
            <div id="county-cities-list" class="chip-list"></div>
          </div>
          <div class="county-events">
            <h3>üìÖ Events & Activities</h3>
            <div id="county-events-list" class="events-grid"></div>
          </div>
        </div>
      </section>

      <!-- City Page (full page, replaces modal for deep links) -->
      <section class="city-page" id="city-page" style="display: none;">
        <div class="card city-card">
          <div class="city-header">
            <h2 id="city-page-title">City</h2>
            <div class="city-actions">
              <button class="nav-btn" id="city-back-county">Back to County</button>
              <button class="nav-btn" id="city-open-admin">Edit City</button>
            </div>
          </div>
          <p id="city-page-county-label" class="city-county-label"></p>
          <p id="city-page-description" class="city-description"></p>
          <div class="city-meta" id="city-meta"></div>
          <div class="city-section">
            <h3>Activities & Attractions</h3>
            <p id="city-page-activities" class="city-activities"></p>
          </div>
          <div class="city-section">
            <h3>Highlights</h3>
            <p id="city-page-highlights" class="city-highlights"></p>
          </div>
          <div class="city-section">
            <h3>Local Businesses</h3>
            <div id="city-page-businesses" class="businesses-list"></div>
          </div>
          <div class="city-section">
            <h3>üìÖ Events & Activities</h3>
            <div id="city-events-list" class="events-grid"></div>
          </div>
        </div>
      </section>

      <!-- Admin Panel -->
      <section class="admin-section" id="admin-section" style="display: none;">
        <!-- Login Screen -->
        <div class="card admin-login" id="admin-login">
          <h2>Admin Login</h2>
          <div id="admin-login-error" class="error-message" style="display: none;"></div>
          <form id="admin-login-form">
            <div class="form-group" id="admin-email-group">
              <label>Email</label>
              <input type="email" id="admin-email" placeholder="admin@example.com" required>
            </div>
            <div class="form-group">
              <label>Password</label>
              <input type="password" id="admin-password" placeholder="Enter password" required>
            </div>
            <button type="submit" class="submit-btn">Login</button>
            <p class="form-note" id="admin-login-note"></p>
          </form>
        </div>

        <!-- Admin Dashboard -->
        <div class="admin-dashboard" id="admin-dashboard" style="display: none;">
          <div class="card">
            <div class="admin-header">
              <h2>County Editor</h2>
              <div>
                <button id="admin-logout-btn" class="nav-btn">Logout</button>
                <button id="admin-settings-btn" class="nav-btn">Settings</button>
              </div>
            </div>
            
            <div class="admin-tabs">
              <button class="admin-tab active" data-tab="counties">Edit Counties</button>
              <button class="admin-tab" data-tab="cities">Edit Cities</button>
              <button class="admin-tab" data-tab="events">Events</button>
              <button class="admin-tab" data-tab="community-awards">Community Awards</button>
              <button class="admin-tab" data-tab="users">Manage Users</button>
              <button class="admin-tab" data-tab="settings">Settings</button>
            </div>

            <!-- Counties Tab -->
            <div class="admin-tab-content" id="tab-counties">
              <div class="admin-search">
                <input type="text" id="county-search" placeholder="Search counties..." class="search-input">
              </div>
              
              <div class="county-list" id="county-list">
                <p class="empty-state">Loading counties...</p>
              </div>
            </div>

            <!-- Cities Tab -->
            <div class="admin-tab-content" id="tab-cities" style="display: none;">
              <div class="admin-search">
                <div class="form-row">
                  <div class="form-group">
                    <label>County</label>
                    <select id="city-admin-county" class="search-input">
                      <option value="">Select County...</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Search</label>
                    <input type="text" id="city-admin-search" placeholder="Search cities..." class="search-input">
                  </div>
                </div>
              </div>
              <div class="county-list" id="city-list">
                <p class="empty-state">Select a county to see its cities.</p>
              </div>
            </div>

            <!-- Events Tab -->
            <div class="admin-tab-content" id="tab-events" style="display: none;">
              <div class="admin-help-box">
                <h4>üí° Events Management</h4>
                <p>Add and manage local events, festivals, business promotions, and outdoor activities for each county and city.</p>
              </div>
              <div class="admin-header-bar">
                <div class="admin-search">
                  <select id="event-filter-county" class="search-input" style="max-width: 200px;">
                    <option value="">All Counties</option>
                  </select>
                  <select id="event-filter-type" class="search-input" style="max-width: 200px;">
                    <option value="">All Types</option>
                    <option value="community">üéâ Community Events</option>
                    <option value="business">üè™ Business Events</option>
                    <option value="historical">üìú Historical Facts</option>
                    <option value="outdoor">üèîÔ∏è Outdoor Activities</option>
                  </select>
                  <input type="text" id="event-search" placeholder="Search events..." class="search-input" style="max-width: 250px;">
                </div>
                <button id="add-event-btn" class="submit-btn">+ Add Event</button>
              </div>
              <div class="event-list" id="event-list">
                <p class="empty-state">No events yet. Click "+ Add Event" to create one.</p>
              </div>
            </div>

            <!-- Community Awards Tab -->
            <div class="admin-tab-content" id="tab-community-awards" style="display: none;">
              <div class="admin-help-box">
                <h4>üèÜ Community Awards Management</h4>
                <p>Grant awards to community members for quizzes, knowledge contributions, helpful routes, and other achievements.</p>
              </div>
              <div class="admin-awards-layout">
                <!-- Member Selector -->
                <div class="award-grant-section">
                  <h4>Grant Award to Member</h4>
                  <div class="form-group">
                    <label>Select Member</label>
                    <select id="award-member-select" class="search-input">
                      <option value="">Choose a member...</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Select Award</label>
                    <select id="award-type-select" class="search-input">
                      <option value="">Choose an award...</option>
                    </select>
                  </div>
                  <div id="award-preview" class="award-preview" style="display: none;">
                    <span class="award-preview-icon" id="award-preview-icon"></span>
                    <div class="award-preview-details">
                      <strong id="award-preview-name"></strong>
                      <p id="award-preview-desc"></p>
                      <span class="award-preview-points" id="award-preview-points"></span>
                    </div>
                  </div>
                  <button id="grant-award-btn" class="submit-btn" disabled>Grant Award</button>
                </div>

                <!-- Member Awards List -->
                <div class="member-awards-overview">
                  <h4>Member Profiles & Awards</h4>
                  <input type="text" id="admin-member-search" placeholder="Search members..." class="search-input">
                  <div id="admin-member-list" class="admin-member-list">
                    <p class="empty-state">Loading members...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Manage Users Tab -->
            <div class="admin-tab-content" id="tab-users" style="display: none;">
              <div class="admin-help-box">
                <h4>üí° User Management</h4>
                <p id="user-help-text">Multi-user authentication requires Firebase. Configure Firebase in firebase-config.js to enable this feature.</p>
              </div>
              <div class="admin-header-bar" id="users-header" style="display: none;">
                <button id="add-user-btn" class="submit-btn">+ Add New User</button>
              </div>
              <div class="user-list" id="user-list">
                <p class="empty-state">Loading users...</p>
              </div>
            </div>

            <!-- Settings Tab -->
            <div class="admin-tab-content" id="tab-settings" style="display: none;">
              <form id="admin-settings-form">
                <div class="form-group">
                  <label>Change Admin Password</label>
                  <input type="password" id="new-password" placeholder="New password">
                </div>
                <div class="form-group">
                  <label>Confirm Password</label>
                  <input type="password" id="confirm-password" placeholder="Confirm password">
                </div>
                <button type="submit" class="submit-btn">Update Password</button>
              </form>
            </div>
          </div>
        </div>

        <!-- City Edit Modal -->
        <div class="modal" id="city-edit-modal" style="display: none;">
          <div class="modal-content card">
            <div class="modal-header">
              <h3 id="modal-city-name">Edit City</h3>
              <button class="modal-close" id="city-modal-close-btn">&times;</button>
            </div>
            <form id="city-edit-form">
              <input type="hidden" id="edit-city-fips">
              <input type="hidden" id="edit-city-slug">

              <div class="form-group">
                <label>City Name (Read-only)</label>
                <input type="text" id="edit-city-display-name" disabled>
              </div>

              <div class="form-group">
                <label>Description</label>
                <textarea id="edit-city-description" rows="4" placeholder="Add a description about this city..."></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Population</label>
                  <input type="text" id="edit-city-population" placeholder="e.g., 53,293">
                </div>
                <div class="form-group">
                  <label>Elevation</label>
                  <input type="text" id="edit-city-elevation" placeholder="e.g., 4,820 ft">
                </div>
              </div>

              <div class="form-group">
                <label>Website URL</label>
                <input type="url" id="edit-city-website" placeholder="https://example.com">
              </div>

              <div class="form-group">
                <label>Activities (comma-separated)</label>
                <input type="text" id="edit-city-activities" placeholder="Skiing, Hiking, Fishing">
              </div>

              <div class="form-group">
                <label>Highlights (comma-separated)</label>
                <input type="text" id="edit-city-highlights" placeholder="State University, Museum, etc.">
              </div>

              <div class="modal-footer">
                <button type="button" class="nav-btn" id="city-modal-cancel-btn">Cancel</button>
                <button type="submit" class="submit-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>

        <!-- County Edit Modal -->
        <div class="modal" id="county-edit-modal" style="display: none;">
          <div class="modal-content card">
            <div class="modal-header">
              <h3 id="modal-county-name">Edit County</h3>
              <button class="modal-close" id="modal-close-btn">&times;</button>
            </div>
            <form id="county-edit-form">
              <input type="hidden" id="edit-county-id">
              
              <div class="form-group">
                <label>County Name (Read-only)</label>
                <input type="text" id="edit-county-display-name" disabled>
              </div>
              
              <div class="form-group">
                <label>Description</label>
                <textarea id="edit-county-description" rows="4" placeholder="Add a description about this county..."></textarea>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Population</label>
                  <input type="text" id="edit-county-population" placeholder="e.g., 45,000">
                </div>
                <div class="form-group">
                  <label>County Seat</label>
                  <input type="text" id="edit-county-seat" placeholder="e.g., Bozeman">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label>Established Year</label>
                  <input type="text" id="edit-county-established" placeholder="e.g., 1864">
                </div>
                <div class="form-group">
                  <label>Area (sq mi)</label>
                  <input type="text" id="edit-county-area" placeholder="e.g., 2,500">
                </div>
              </div>
              
              <div class="form-group">
                <label>Website URL</label>
                <input type="url" id="edit-county-website" placeholder="https://example.com">
              </div>
              
              <div class="form-group">
                <label>Points of Interest (comma-separated)</label>
                <input type="text" id="edit-county-poi" placeholder="Yellowstone, Glacier Park, etc.">
              </div>
              
              <div class="modal-footer">
                <button type="button" class="nav-btn" id="modal-cancel-btn">Cancel</button>
                <button type="submit" class="submit-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Add User Modal -->
        <div class="modal" id="add-user-modal" style="display: none;">
          <div class="modal-content card">
            <div class="modal-header">
              <h3 id="user-modal-title">Add New Admin User</h3>
              <button class="modal-close" id="user-modal-close-btn">&times;</button>
            </div>
            <form id="add-user-form">
              <div class="form-group">
                <label>Email Address *</label>
                <input type="email" id="new-user-email" placeholder="admin@example.com" required>
              </div>

              <div class="form-group">
                <label>Display Name</label>
                <input type="text" id="new-user-name" placeholder="John Doe">
              </div>

              <div class="form-group">
                <label>Temporary Password *</label>
                <input type="password" id="new-user-password" placeholder="Minimum 6 characters" required>
                <p class="form-note">User should change this password on first login.</p>
              </div>

              <div class="form-group">
                <label>Role</label>
                <select id="new-user-role">
                  <option value="admin">Admin (Full Access)</option>
                  <option value="editor">Editor (Content Only)</option>
                </select>
              </div>

              <div class="modal-footer">
                <button type="button" class="nav-btn" id="user-modal-cancel-btn">Cancel</button>
                <button type="submit" class="submit-btn">Add User</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Event Edit Modal -->
        <div class="modal" id="event-edit-modal" style="display: none;">
          <div class="modal-content card" style="max-width: 700px;">
            <div class="modal-header">
              <h3 id="event-modal-title">Add Event</h3>
              <button class="modal-close" id="event-modal-close-btn">&times;</button>
            </div>
            <form id="event-edit-form">
              <input type="hidden" id="edit-event-id">

              <div class="form-group">
                <label>Event Name *</label>
                <input type="text" id="edit-event-name" placeholder="Montana State Fair" required>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Event Type *</label>
                  <select id="edit-event-type" required>
                    <option value="community">üéâ Community Event</option>
                    <option value="business">üè™ Business Event</option>
                    <option value="historical">üìú Historical Fact</option>
                    <option value="outdoor">üèîÔ∏è Outdoor Activity</option>
                  </select>
                </div>
                <div class="form-group">
                  <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="edit-event-featured">
                    Featured Event
                  </label>
                </div>
              </div>

              <div class="form-group">
                <label>Description *</label>
                <textarea id="edit-event-description" rows="4" placeholder="Describe the event..." required></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>County *</label>
                  <select id="edit-event-county" required>
                    <option value="">Select County...</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>City (optional)</label>
                  <select id="edit-event-city">
                    <option value="">County-wide</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Start Date</label>
                  <input type="date" id="edit-event-start">
                </div>
                <div class="form-group">
                  <label>End Date (optional)</label>
                  <input type="date" id="edit-event-end">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Recurring</label>
                  <select id="edit-event-recurring">
                    <option value="">One-time</option>
                    <option value="annual">Annual</option>
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Price</label>
                  <input type="text" id="edit-event-price" placeholder="Free or $10-25">
                </div>
              </div>

              <div class="form-group">
                <label>Address/Location</label>
                <input type="text" id="edit-event-address" placeholder="Event venue or location">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Website</label>
                  <input type="url" id="edit-event-website" placeholder="https://example.com">
                </div>
                <div class="form-group">
                  <label>Contact Email</label>
                  <input type="email" id="edit-event-email" placeholder="info@example.com">
                </div>
              </div>

              <div class="form-group">
                <label>Contact Phone</label>
                <input type="tel" id="edit-event-phone" placeholder="(406) 555-1234">
              </div>

              <div class="modal-footer">
                <button type="button" class="nav-btn" id="event-modal-cancel-btn">Cancel</button>
                <button type="button" class="nav-btn danger" id="event-delete-btn" style="display: none;">Delete Event</button>
                <button type="submit" class="submit-btn">Save Event</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- City Page Modal -->
      <div class="modal" id="city-modal" style="display: none;">
        <div class="modal-content card" style="max-width: 800px;">
          <div class="modal-header">
            <h3 id="city-modal-title">City Name</h3>
            <button class="modal-close" id="city-modal-close">&times;</button>
          </div>
          <div class="city-modal-body">
            <div class="city-info">
              <p id="city-county-info" style="color: var(--wood-dark); margin-bottom: 20px;"></p>
              
              <h4 style="margin-top: 20px; margin-bottom: 10px; color: var(--wood-dark);">üìç Businesses in <span id="city-name-businesses"></span></h4>
              <div id="city-businesses-list" class="businesses-list">
                <p style="color: var(--ink-dark); font-style: italic;">No businesses registered yet.</p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="nav-btn" id="city-modal-back">Back to County</button>
          </div>
        </div>
      </div>

      <!-- Business Submission Form -->
      <section class="form-section" id="business-form-section" style="display: none;">
        <div class="card form-card">
          <h2>Business Directory Listing</h2>
          <form id="business-form">
            <div class="form-row">
              <div class="form-group">
                <label>Business Name</label>
                <input type="text" id="biz-name" required>
              </div>
              <div class="form-group">
                <label>County</label>
                <select id="biz-county" required>
                  <option value="">Select County...</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>City</label>
                <select id="biz-city" required>
                  <option value="">Select County First...</option>
                </select>
              </div>
              <div class="form-group">
                <label>Address</label>
                <input type="text" id="biz-address" placeholder="123 Main St" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="biz-phone" placeholder="(406) 555-0123">
              </div>
              <div class="form-group">
                <label>Website</label>
                <input type="url" id="biz-website" placeholder="https://example.com">
              </div>
            </div>
            <div class="form-group">
              <label>Icon</label>
              <input type="text" id="biz-icon" placeholder="üè™" maxlength="2">
            </div>
            <button type="submit" class="submit-btn">Add Business Listing</button>
            <p class="form-note">$5/month subscription ‚Ä¢ Cancel anytime</p>
          </form>
        </div>
      </section>

      <!-- Discussion Board Section -->
      <section class="discussion-section" id="discussion-section" style="display: none;">
        <div class="card discussion-card">
          <div class="discussion-header">
            <h2>üí¨ Montana Community Discussion</h2>
            <p class="discussion-subtitle">Share knowledge, ask questions, earn awards & climb the ranks</p>
          </div>

          <div class="discussion-layout">
            <!-- Leaderboard Sidebar -->
            <aside class="discussion-sidebar">
              <div class="leaderboard-section">
                <h3>üèÜ Top Members</h3>
                <div id="leaderboard" class="leaderboard-list">
                  <p class="empty-state">Loading members...</p>
                </div>
              </div>
              <div class="awards-section">
                <h3>üéñÔ∏è Your Awards</h3>
                <div id="user-awards" class="awards-display">
                  <p class="empty-state">Sign in to view awards</p>
                </div>
              </div>
            </aside>

            <!-- Main Discussion Area -->
            <div class="discussion-main">
              <!-- Post Creation Form -->
              <div class="post-form-wrapper card">
                <h3>Start a Discussion</h3>
                <form id="discussion-post-form">
                  <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="discussion-username" placeholder="Community Member" maxlength="30" required>
                  </div>
                  <div class="form-group">
                    <label>Topic</label>
                    <input type="text" id="discussion-topic" placeholder="e.g., Best hiking spots in Montana..." maxlength="100" required>
                  </div>
                  <div class="form-group">
                    <label>Message</label>
                    <textarea id="discussion-message" placeholder="Share your Montana knowledge or ask a question..." rows="4" maxlength="500" required></textarea>
                  </div>
                  <div class="form-group">
                    <label>Category</label>
                    <select id="discussion-category" required>
                      <option value="">Select a category...</option>
                      <option value="wildlife">ü¶å Wildlife & Nature</option>
                      <option value="history">üìú History & Culture</option>
                      <option value="hiking">üèîÔ∏è Hiking & Outdoor</option>
                      <option value="cities">üèòÔ∏è Cities & Towns</option>
                      <option value="geology">ü™® Geology & Geography</option>
                      <option value="tips">üí° Local Tips & Advice</option>
                      <option value="general">üó®Ô∏è General Discussion</option>
                    </select>
                  </div>
                  <button type="submit" class="submit-btn">Post Discussion</button>
                </form>
              </div>

              <!-- Filter & Search -->
              <div class="discussion-filters card">
                <input type="text" id="discussion-search" placeholder="Search discussions..." class="search-input">
                <div class="filter-buttons">
                  <button class="filter-btn active" data-filter="all">All</button>
                  <button class="filter-btn" data-filter="wildlife">Wildlife</button>
                  <button class="filter-btn" data-filter="history">History</button>
                  <button class="filter-btn" data-filter="hiking">Hiking</button>
                  <button class="filter-btn" data-filter="cities">Cities</button>
                  <button class="filter-btn" data-filter="geology">Geology</button>
                  <button class="filter-btn" data-filter="tips">Tips</button>
                </div>
              </div>

              <!-- Discussions List -->
              <div id="discussions-list" class="discussions-list">
                <p class="empty-state">No discussions yet. Be the first to start one!</p>
              </div>

              <!-- Back Button -->
              <button id="discussion-close-btn" class="nav-btn" style="width: 100%; margin-top: 1.5rem;">Back to Map</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== AUTH SECTION (Sign In / Register / Forgot Password) ===== -->
      <section class="auth-section" id="auth-section" style="display: none;">
        <div class="card auth-card">
          <button class="auth-close-btn" id="auth-close-btn">&times;</button>
          
          <!-- Auth Tabs -->
          <div class="auth-tabs">
            <button class="auth-tab active" data-auth-tab="signin">Sign In</button>
            <button class="auth-tab" data-auth-tab="register">Register</button>
            <button class="auth-tab" data-auth-tab="forgot">Forgot Password</button>
          </div>

          <!-- Sign In Form -->
          <div class="auth-tab-content" id="auth-tab-signin">
            <div class="auth-header">
              <h2>Welcome Back</h2>
              <p>Sign in to your Montana Explorer account</p>
            </div>
            <div id="signin-error" class="auth-error" style="display: none;"></div>
            <form id="signin-form">
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="signin-email" placeholder="your@email.com" required>
              </div>
              <div class="form-group">
                <label>Password</label>
                <input type="password" id="signin-password" placeholder="Enter password" required>
              </div>
              <button type="submit" class="submit-btn">Sign In</button>
              <p class="auth-link">Don't have an account? <a href="#" id="auth-goto-register">Register here</a></p>
              <p class="auth-link"><a href="#" id="auth-goto-forgot">Forgot your password?</a></p>
            </form>
          </div>

          <!-- Register Form -->
          <div class="auth-tab-content" id="auth-tab-register" style="display: none;">
            <div class="auth-header">
              <h2>Join Montana Explorer</h2>
              <p>Create your account and start earning awards</p>
            </div>
            <div id="register-error" class="auth-error" style="display: none;"></div>
            <form id="register-form">
              <div class="form-group">
                <label>Display Name</label>
                <input type="text" id="register-name" placeholder="Your display name" maxlength="30" required>
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="register-email" placeholder="your@email.com" required>
              </div>
              <div class="form-group">
                <label>Password</label>
                <input type="password" id="register-password" placeholder="Minimum 6 characters" minlength="6" required>
              </div>
              <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="register-confirm" placeholder="Confirm password" minlength="6" required>
              </div>
              <div class="form-group">
                <label>Choose Your Avatar</label>
                <div class="avatar-picker" id="avatar-picker">
                  <span class="avatar-option selected" data-emoji="üë§">üë§</span>
                  <span class="avatar-option" data-emoji="ü§†">ü§†</span>
                  <span class="avatar-option" data-emoji="ü¶å">ü¶å</span>
                  <span class="avatar-option" data-emoji="üêª">üêª</span>
                  <span class="avatar-option" data-emoji="üèîÔ∏è">üèîÔ∏è</span>
                  <span class="avatar-option" data-emoji="üå≤">üå≤</span>
                  <span class="avatar-option" data-emoji="ü¶Ö">ü¶Ö</span>
                  <span class="avatar-option" data-emoji="üê∫">üê∫</span>
                  <span class="avatar-option" data-emoji="üé£">üé£</span>
                  <span class="avatar-option" data-emoji="‚õ∑Ô∏è">‚õ∑Ô∏è</span>
                </div>
                <input type="hidden" id="register-avatar" value="üë§">
              </div>
              <button type="submit" class="submit-btn">Create Account</button>
              <p class="auth-link">Already have an account? <a href="#" id="auth-goto-signin">Sign in here</a></p>
            </form>
          </div>

          <!-- Forgot Password Form -->
          <div class="auth-tab-content" id="auth-tab-forgot" style="display: none;">
            <div class="auth-header">
              <h2>Reset Password</h2>
              <p>Enter your email to receive a password reset link</p>
            </div>
            <div id="forgot-error" class="auth-error" style="display: none;"></div>
            <div id="forgot-success" class="auth-success" style="display: none;"></div>
            <form id="forgot-form">
              <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="forgot-email" placeholder="your@email.com" required>
              </div>
              <button type="submit" class="submit-btn">Send Reset Link</button>
              <p class="auth-link"><a href="#" id="auth-goto-signin2">Back to Sign In</a></p>
            </form>
          </div>
        </div>
      </section>

      <!-- ===== USER PROFILE & SETTINGS ===== -->
      <section class="profile-section" id="profile-section" style="display: none;">
        <div class="card profile-card">
          <div class="profile-header">
            <h2>üë§ My Profile & Settings</h2>
            <button class="nav-btn" id="profile-close-btn">Back to Map</button>
          </div>

          <div class="profile-layout">
            <!-- Profile Overview -->
            <div class="profile-overview">
              <div class="profile-avatar" id="profile-avatar-display">üë§</div>
              <h3 id="profile-display-name">Member</h3>
              <span class="profile-rank" id="profile-rank">üë§ Member</span>
              <div class="profile-stats">
                <div class="profile-stat">
                  <span class="stat-value" id="profile-total-points">0</span>
                  <span class="stat-label">Points</span>
                </div>
                <div class="profile-stat">
                  <span class="stat-value" id="profile-post-count">0</span>
                  <span class="stat-label">Posts</span>
                </div>
                <div class="profile-stat">
                  <span class="stat-value" id="profile-award-count">0</span>
                  <span class="stat-label">Awards</span>
                </div>
              </div>
            </div>

            <!-- Profile Awards -->
            <div class="profile-awards-section">
              <h3>üéñÔ∏è My Awards</h3>
              <div id="profile-awards-grid" class="profile-awards-grid">
                <p class="empty-state">No awards earned yet. Start contributing!</p>
              </div>
            </div>

            <!-- Profile Settings Form -->
            <div class="profile-settings-section">
              <h3>‚öôÔ∏è Settings</h3>
              <form id="profile-settings-form">
                <div class="form-group">
                  <label>Display Name</label>
                  <input type="text" id="profile-edit-name" placeholder="Your display name" maxlength="30">
                </div>
                <div class="form-group">
                  <label>Bio</label>
                  <textarea id="profile-edit-bio" placeholder="Tell us about yourself and your Montana experience..." rows="3" maxlength="200"></textarea>
                </div>
                <div class="form-group">
                  <label>Avatar</label>
                  <div class="avatar-picker" id="profile-avatar-picker">
                    <span class="avatar-option" data-emoji="üë§">üë§</span>
                    <span class="avatar-option" data-emoji="ü§†">ü§†</span>
                    <span class="avatar-option" data-emoji="ü¶å">ü¶å</span>
                    <span class="avatar-option" data-emoji="üêª">üêª</span>
                    <span class="avatar-option" data-emoji="üèîÔ∏è">üèîÔ∏è</span>
                    <span class="avatar-option" data-emoji="üå≤">üå≤</span>
                    <span class="avatar-option" data-emoji="ü¶Ö">ü¶Ö</span>
                    <span class="avatar-option" data-emoji="üê∫">üê∫</span>
                    <span class="avatar-option" data-emoji="üé£">üé£</span>
                    <span class="avatar-option" data-emoji="‚õ∑Ô∏è">‚õ∑Ô∏è</span>
                  </div>
                  <input type="hidden" id="profile-edit-avatar" value="üë§">
                </div>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="profile-show-leaderboard" checked>
                    Show me on the public leaderboard
                  </label>
                </div>
                <div class="form-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="profile-public-profile" checked>
                    Make my profile visible to others
                  </label>
                </div>
                <button type="submit" class="submit-btn">Save Settings</button>
              </form>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== TOP 20 AWARDS & LEADERBOARD PAGE ===== -->
      <section class="awards-page-section" id="awards-page-section" style="display: none;">
        <div class="card awards-page-card">
          <div class="awards-page-header">
            <h2>üèÜ Montana Explorer Top 20 Leaderboard</h2>
            <p class="awards-page-subtitle">The most knowledgeable and helpful Montana explorers</p>
            <button class="nav-btn" id="awards-page-close-btn">Back to Map</button>
          </div>

          <!-- Leaderboard -->
          <div class="awards-leaderboard-section">
            <div class="top3-podium" id="top3-podium">
              <!-- Filled by JS -->
            </div>
            <div class="full-leaderboard" id="full-leaderboard">
              <!-- Filled by JS -->
            </div>
          </div>

          <!-- All Available Awards -->
          <div class="all-awards-section">
            <h3>üéñÔ∏è Available Awards</h3>
            <p class="awards-section-subtitle">Earn these awards by contributing knowledge, completing quizzes, and exploring Montana</p>
            <div class="awards-catalog" id="awards-catalog">
              <!-- Filled by JS -->
            </div>
          </div>
        </div>
      </section>

      <!-- Map Section -->
      <section class="map-section" id="map-section">
        <div class="map-header">
          <h2>Interactive County Map</h2>
          <p class="map-description">Click any county to view details</p>
        </div>
        <div id="map"></div>
        
        <!-- Layer Controller -->
        <div class="layer-controller" id="layer-controller">
          <div class="layer-header">
            <h3>üó∫Ô∏è Explorer Layers</h3>
            <button class="layer-toggle-btn" id="layer-toggle-btn">‚óÄ</button>
          </div>
          
          <div class="layer-group">
            <h4>üå≤ Nature</h4>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="watersheds">
              <span>üíß Watersheds</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="grizzly">
              <span>üêª Grizzly Ranges</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="peaks">
              <span>‚õ∞Ô∏è Mountain Peaks</span>
            </label>
          </div>
          
          <div class="layer-group">
            <h4>üìú History</h4>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="lewis-clark">
              <span>üõ∂ Lewis & Clark Trail</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="native-lands">
              <span>üèõÔ∏è Native Ancestral Lands</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="ghost-towns">
              <span>üëª Ghost Towns</span>
            </label>
          </div>
          
          <div class="layer-group">
            <h4>üè≠ Industry</h4>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="mines">
              <span>‚õèÔ∏è Active Mines</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="agriculture">
              <span>üåæ Agriculture Zones</span>
            </label>
            <label class="layer-item">
              <input type="checkbox" class="layer-checkbox" data-layer="wind-farms">
              <span>üí® Wind Farms</span>
            </label>
          </div>
        </div>
        
        <!-- Interactive HUD -->
        <div class="hud-panel" id="hud-panel">
          <div class="hud-header">
            <span class="hud-title">üí° Did You Know?</span>
            <button class="hud-close" id="hud-close">√ó</button>
          </div>
          <div class="hud-content" id="hud-content">
            <p>Explore the map to discover fascinating facts about Montana's regions, history, and natural wonders!</p>
          </div>
          <div class="hud-footer">
            <span class="hud-location" id="hud-location">Montana</span>
          </div>
        </div>
      </section>

      <!-- Information Grid -->
      <section class="info-grid" id="info-section" style="display: none;">
        <div class="card">
          <h3>Mountain Passes</h3>
          <div id="passes-list" class="content-list">
            <p class="empty-state">No data available</p>
          </div>
        </div>
        <div class="card">
          <h3>Weather Stations</h3>
          <div id="weather-stations" class="content-list">
            <p class="empty-state">No data available</p>
          </div>
        </div>
        <div class="card">
          <h3>Local Businesses</h3>
          <div id="business-list" class="content-list">
            <p class="empty-state">No listings yet</p>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>&copy; 2026 Montana County Explorer</p>
      <p class="last-updated" id="last-updated"></p>
      <button id="admin-btn" class="admin-access-button" title="Admin Panel Access">‚öôÔ∏è</button>
    </footer>
  </div>

  <!-- Firebase compat SDK (only loaded if you configure firebase-config.js) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
